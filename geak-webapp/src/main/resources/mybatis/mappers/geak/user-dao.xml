<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.xsocket.geak.dao.GeakUserDao">


  <resultMap id="result" type="com.github.xsocket.geak.entity.GeakUser">
    <id property="id"           column="id"       javaType="String" jdbcType="VARCHAR" />
    <result property="account"  column="account"  javaType="String" jdbcType="VARCHAR" />
    <result property="name"     column="name"     javaType="String" jdbcType="VARCHAR" />
    <result property="password" column="password" javaType="String" jdbcType="VARCHAR" />
    <result property="state"    column="state"    javaType="String" jdbcType="VARCHAR" />
    <!-- 关联公司(门店) -->
    <association property="company" javaType="com.github.xsocket.geak.entity.Company">
      <id     property="id"      column="company_id"      javaType="Integer" jdbcType="INTEGER" />
      <result property="name"    column="company_name"    javaType="String"  jdbcType="VARCHAR" />
      <result property="alias"   column="company_alias"   javaType="String"  jdbcType="VARCHAR" />
      <result property="address" column="company_address" javaType="String"  jdbcType="VARCHAR" />
    </association>
    <!-- 有问题 
    <collection property="companies" column="id" ofType="com.github.xsocket.geak.entity.Company" 
        select="com.github.xsocket.geak.dao.CompanyDao.selectByUserId" />
        -->
  </resultMap>
  
  <select id="selectAll" resultMap="com.github.xsocket.geak.dao.GeakUserDao.result">
    SELECT a.id, a.account, a.name, a.password, a.state,
      c.id as company_id, c.name as company_name, c.alias as company_alias, c.address as company_address
    FROM aa_user a
      JOIN geak_user g ON a.id = g.id
      JOIN geak_company c ON g.company_id = c.id 
    ORDER BY g.company_id, a.name
  </select>

  <select id="selectById" resultMap="com.github.xsocket.geak.dao.GeakUserDao.result">
    SELECT a.id, a.account, a.name, a.password, a.state,
      c.id as company_id, c.name as company_name, c.alias as company_alias, c.address as company_address
    FROM aa_user a
      JOIN geak_user g ON a.id = g.id
      JOIN geak_company c ON g.company_id = c.id 
    WHERE 
      a.id = #{id,javaType=String,jdbcType=VARCHAR}
  </select>

  <insert id="insert">
    INSERT INTO geak_user  (id, company_id) 
    VALUES ( #{id,javaType=String,jdbcType=VARCHAR}, #{company.id,jdbcType=Integer,jdbcType=INTEGER} )
  </insert>
  
  <update id="update">
    UPDATE geak_user
    SET company_id =  #{company.id,jdbcType=Integer,jdbcType=INTEGER}
    WHERE 
      id = #{id,javaType=String,jdbcType=VARCHAR}
  </update>
  
  <delete id="delete">
    DELETE FROM geak_user
    WHERE id = #{id,javaType=String,jdbcType=VARCHAR}
  </delete>

</mapper>